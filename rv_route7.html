<!DOCTYPE html>
<html>
<head>
    <title>RV Route: Billings, MT to Ocala, FL</title>
    <meta name="viewport" content="initial-scale=1.0">
    <style>
        #map {
            height: 70vh; /* Primary height */
            min-height: 500px; /* Fallback for visibility */
            width: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        #summary-table {
            width: 100%;
            max-width: 1200px;
            margin: 10px auto;
            border-collapse: collapse;
            font-size: 14px;
        }
        #summary-table th, #summary-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        #summary-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        #summary-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        #summary-table tr:hover {
            background-color: #f5f5f5;
        }
        @media (max-width: 800px) {
            #summary-table {
                font-size: 12px;
            }
            #summary-table th, #summary-table td {
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <div id="summary-table-container"></div>
    <div id="map"></div>
    <script>
        // Google Maps API key
        const API_KEY = 'AIzaSyBP1hv_hVmLDXD4V-yDUjRdK7FRPdbxdBY';

        // Log to confirm script start
        console.log('Script started. Using API key:', API_KEY);

        // Itinerary waypoints
        const itinerary = [
            {
                lat: 45.7833,
                lng: -108.5007,
                title: 'Day 1, Oct 16, 2025: Start - Billings, MT',
                info: 'Starting point in Billings, MT',
                travelInfo: 'To Sheridan, WY: ~130 miles, ~2 hr 15 min',
                avgTemp: '~50°F'
            },
            {
                lat: 44.8336,
                lng: -106.9011,
                title: 'Day 2, Oct 16, 2025: Sheridan, WY',
                info: 'Sheridan/Big Horn Mountains KOA, 63 Decker Rd, Sheridan, WY 82801, (307) 674-8766, ~$40–$60/night',
                travelInfo: 'To Casper, WY: ~150 miles, ~2 hr 30 min',
                avgTemp: '~50°F'
            },
            {
                lat: 42.8666,
                lng: -106.3131,
                title: 'Day 3, Oct 17, 2025: Casper, WY',
                info: 'Casper East RV Park, 2800 E Yellowstone Hwy, Casper, WY 82609, (307) 234-3260, ~$35–$50/night',
                travelInfo: 'To Denver, CO: ~280 miles, ~4 hr 30 min',
                avgTemp: '~45°F'
            },
            {
                lat: 39.7369,
                lng: -104.3206,
                title: 'Days 4-6, Oct 18-20, 2025: Denver, CO',
                info: 'Denver East/Strasburg KOA, 1312 Monroe St, Strasburg, CO 80136, (303) 622-9274, ~$45–$65/night, 3-night stay',
                travelInfo: 'To North Platte, NE: ~260 miles, ~4 hr',
                avgTemp: '~55°F'
            },
            {
                lat: 41.1350,
                lng: -100.7607,
                title: 'Day 7, Oct 21, 2025: North Platte, NE',
                info: 'Holiday RV Park, 601 Halligan Dr, North Platte, NE 69101, (308) 534-2265, ~$35–$50/night',
                travelInfo: 'To Grand Island, NE: ~150 miles, ~2 hr 30 min',
                avgTemp: '~50°F'
            },
            {
                lat: 40.9250,
                lng: -98.3420,
                title: 'Day 8, Oct 22, 2025: Grand Island, NE',
                info: 'Grand Island KOA Journey, 904 S B Rd, Doniphan, NE 68832, (402) 886-2249, ~$35–$50/night',
                travelInfo: 'To Topeka, KS: ~300 miles, ~4 hr 45 min',
                avgTemp: '~50°F'
            },
            {
                lat: 39.0558,
                lng: -95.6890,
                title: 'Day 9, Oct 23, 2025: Topeka, KS',
                info: 'Topeka/Shawnee County KOA, 3435 SE 45th St, Topeka, KS 66609, (785) 862-7200, ~$40–$60/night',
                travelInfo: 'To Oklahoma City, OK: ~300 miles, ~4 hr 45 min',
                avgTemp: '~55°F'
            },
            {
                lat: 35.4457,
                lng: -97.7338,
                title: 'Days 10-16, Oct 24-30, 2025: Oklahoma City, OK',
                info: 'Mustang Run RV Park, 2000 S Mustang Rd, Yukon, OK 73099, (405) 577-6084, ~$45–$65/night, 7-night stay',
                travelInfo: 'To Fort Smith, AR: ~190 miles, ~3 hr',
                avgTemp: '~60°F'
            },
            {
                lat: 35.3667,
                lng: -94.3986,
                title: 'Day 17, Oct 31, 2025: Fort Smith, AR',
                info: 'Fort Smith KOA, 5111 Rogers Ave, Fort Smith, AR 72903, (479) 783-8300, ~$35–$50/night',
                travelInfo: 'To Murfreesboro, AR: ~160 miles, ~2 hr 45 min',
                avgTemp: '~55°F'
            },
            {
                lat: 34.0647,
                lng: -93.6899,
                title: 'Days 18-20, Nov 1-3, 2025: Murfreesboro, AR (Crater of Diamonds State Park)',
                info: 'Diamonds Old West RV Park, 2310 US-301, Murfreesboro, AR 71958, (870) 285-4210, ~$40–$55/night, 3-night stay. Visit Crater of Diamonds State Park for diamond hunting.',
                travelInfo: 'To Jackson, MS: ~300 miles, ~4 hr 45 min',
                avgTemp: '~55°F'
            },
            {
                lat: 32.2988,
                lng: -90.1848,
                title: 'Day 21, Nov 4, 2025: Jackson, MS',
                info: 'LeFleur’s Bluff State Park, 3315 Lakeland Terrace, Jackson, MS 39216, (601) 987-3920, ~$30–$45/night',
                travelInfo: 'To Marietta, GA: ~400 miles, ~4 hr 45 min',
                avgTemp: '~60°F'
            },
            {
                lat: 33.9157,
                lng: -84.4822,
                title: 'Day 22, Nov 5, 2025: Marietta, GA',
                info: 'Atlanta Marietta RV Resort, 1031 Wylie Rd SE, Marietta, GA 30067, (770) 427-6853, ~$50–$70/night',
                travelInfo: 'To Ocala, FL: ~400 miles, ~4 hr 45 min',
                avgTemp: '~55°F'
            },
            {
                lat: 29.1871,
                lng: -82.1400,
                title: 'Day 23, Nov 6, 2025: Ocala, FL',
                info: 'Ocala Sun RV Resort, 2559 NW 87th Pl, Ocala, FL 34475, (352) 307-1100, ~$50–$70/night',
                travelInfo: 'Final destination',
                avgTemp: '~65°F'
            }
        ];

        // Initialize the map and generate table
        function initMap() {
            console.log('initMap called. Checking Google Maps API...');

            // Check if Google Maps API loaded
            if (typeof google === 'undefined' || !google.maps) {
                console.error('Google Maps API failed to load. Check API key, network, or browser console for errors.');
                return;
            }

            // Check map container
            const mapDiv = document.getElementById('map');
            if (!mapDiv) {
                console.error('Map container (#map) not found in DOM.');
                return;
            }
            console.log('Map container found. Initializing map...');

            // Initialize map
            const map = new google.maps.Map(mapDiv, {
                zoom: 4,
                center: { lat: 39.8283, lng: -98.5795 } // Center of USA
            });
            console.log('Map initialized successfully.');

            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer({
                map: map,
                suppressMarkers: true // Suppress default markers
            });

            // Add custom markers with info windows
            const infoWindow = new google.maps.InfoWindow();
            itinerary.forEach((stop, index) => {
                try {
                    const marker = new google.maps.Marker({
                        position: { lat: stop.lat, lng: stop.lng },
                        map: map,
                        title: stop.title,
                        icon: {
                            url: 'http://maps.google.com/mapfiles/ms/icons/' + (index === 0 ? 'green-dot.png' : index === itinerary.length - 1 ? 'red-dot.png' : 'blue-dot.png')
                        }
                    });

                    marker.addListener('click', () => {
                        infoWindow.setContent(`<h3>${stop.title}</h3><p>${stop.info}</p><p>${stop.travelInfo}</p><p>Expected Avg Temp: ${stop.avgTemp}</p>`);
                        infoWindow.open(map, marker);
                    });
                } catch (e) {
                    console.error('Error creating marker for stop:', stop.title, e);
                }
            });
            console.log('Markers added successfully.');

            // Create waypoints for Directions API
            const waypoints = itinerary.slice(1, -1).map(stop => ({
                location: new google.maps.LatLng(stop.lat, stop.lng),
                stopover: true
            }));

            // Request driving route
            try {
                directionsService.route({
                    origin: new google.maps.LatLng(itinerary[0].lat, itinerary[0].lng),
                    destination: new google.maps.LatLng(itinerary[itinerary.length - 1].lat, itinerary[itinerary.length - 1].lng),
                    waypoints: waypoints,
                    travelMode: google.maps.TravelMode.DRIVING,
                    optimizeWaypoints: false
                }, (response, status) => {
                    if (status === 'OK') {
                        directionsRenderer.setDirections(response);
                        console.log('Directions rendered successfully.');
                    } else {
                        console.error('Directions request failed: ', status);
                    }
                });
            } catch (e) {
                console.error('Error requesting directions:', e);
            }

            // Generate summary table
            const tableContainer = document.getElementById('summary-table-container');
            if (!tableContainer) {
                console.error('Table container (#summary-table-container) not found.');
                return;
            }
            console.log('Table container found. Generating table...');

            const table = document.createElement('table');
            table.id = 'summary-table';

            // Create table header
            const headerRow = document.createElement('tr');
            const headers = ['City', 'Arrival Date', 'Stay Duration', 'Campground Info', 'Distance to Next', 'Drive Time', 'Avg Temp'];
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);

            // Create table rows
            itinerary.forEach(stop => {
                try {
                    const row = document.createElement('tr');

                    // City
                    const cityMatch = stop.title.match(/: (?:Start - )?(.+)$/);
                    const city = cityMatch ? cityMatch[1] : 'Unknown';
                    const cityCell = document.createElement('td');
                    cityCell.textContent = city;
                    row.appendChild(cityCell);

                    // Arrival Date
                    const dateMatch = stop.title.match(/(?:Day|Days) \d+(?:-\d+)?, (.+?):/);
                    const arrivalDate = dateMatch ? dateMatch[1] : 'N/A';
                    const dateCell = document.createElement('td');
                    dateCell.textContent = arrivalDate;
                    row.appendChild(dateCell);

                    // Stay Duration
                    const stayDuration = stop.info.includes('3-night stay') ? '3 nights' : 
                                         stop.info.includes('7-night stay') ? '7 nights' : '1 night';
                    const durationCell = document.createElement('td');
                    durationCell.textContent = stayDuration;
                    row.appendChild(durationCell);

                    // Campground Info
                    const campgroundInfo = stop.info.replace(/, (?:3|7)-night stay\.?(?: Visit Crater .*)?$/, '');
                    const campgroundCell = document.createElement('td');
                    campgroundCell.textContent = campgroundInfo;
                    row.appendChild(campgroundCell);

                    // Distance to Next
                    const distanceMatch = stop.travelInfo.match(/~(\d+) miles/);
                    const distance = distanceMatch ? `~${distanceMatch[1]} miles` : 'N/A';
                    const distanceCell = document.createElement('td');
                    distanceCell.textContent = distance;
                    row.appendChild(distanceCell);

                    // Drive Time
                    const timeMatch = stop.travelInfo.match(/~(.+?)(?:,|$)/);
                    const driveTime = timeMatch ? `~${timeMatch[1].trim()}` : 'N/A';
                    const timeCell = document.createElement('td');
                    timeCell.textContent = driveTime;
                    row.appendChild(timeCell);

                    // Expected Avg Temp
                    const tempCell = document.createElement('td');
                    tempCell.textContent = stop.avgTemp;
                    row.appendChild(tempCell);

                    table.appendChild(row);
                } catch (e) {
                    console.error('Error generating table row for stop:', stop.title, e);
                }
            });

            tableContainer.appendChild(table);
            console.log('Table generated successfully.');
        }
    </script>
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBP1hv_hVmLDXD4V-yDUjRdK7FRPdbxdBY&callback=initMap">
    </script>
</body>
</html>